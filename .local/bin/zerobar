#!/bin/sh
#         .             .              .		  
#         |             |              |           .	  
# ,-. ,-. |-. ,-. . ,-. |  ,_, ,-. ,-. |-. ,-,-. . |- ,_, 
# | | ,-| | | |   | |-' |   /  `-. |   | | | | | | |   /  
# `-| `-^ ^-' '   ' `-' `' '"' `-' `-' ' ' ' ' ' ' `' '"' 
#  ,|							  
#  `'							  
# GITHUB:https://github.com/gabrielzschmitz		  
# INSTAGRAM:https://www.instagram.com/gabrielzschmitz_/   
# DOTFILES:https://github.com/gabrielzschmitz/dotfiles/   

# ^c$var^ = fg color
# ^b$var^ = bg color

# load colors
black=#080808
green=#375759
white=#e5e5e5
grey=#141414
blue=#324f66
red=#453057
darkblue=#3f5273
yellow=#736871

interval=0

cpu() {
    cpu_val=$(grep -o "^[^ ]*" /proc/loadavg)

    printf "^c$black^ ^b$green^ "
    printf "^c$green^ ^b$black^ $cpu_val "
}

pkg_updates() {
    #updates=$(doas xbps-install -un | wc -l) # void
    updates=$(paru -Qu | wc -l)   # arch
    # updates=$(aptitude search '~U' | wc -l)  # apt (ubuntu,debian etc)

    if [ -z "$updates" ]; then
        printf "^c$green^  Fully Updated"
    else
        printf "^c$green^  $updates"" updates"
    fi
}

battery() {
    get_capacity="$(cat /sys/class/power_supply/BAT1/capacity)"
    capacity="$(cat /sys/class/power_supply/BAT?*/capacity 2>/dev/null)"
    [ "$capacity" -le 200 ] && status="" 
    [ "$capacity" -le 80 ] && status=""
    [ "$capacity" -le 60 ] && status=""
    [ "$capacity" -le 40 ] && status=""
    [ "$capacity" -le 20 ] && status=""
    [ "$capacity" -le 10 ] && warn=""
    [ "$capacity" -le 5 ] && herbe " Battery is low " &
    printf " ^c$blue^""$status""$warn"

    case "$get_capacity" in
        96|97|98|99|100|101|102|103|104|105) printf "^c$blue^ 100";;
        *) printf "^c$blue^ $get_capacity";;
    esac
}

brightness() {
    brightness_val=$(cat /sys/class/backlight/*/brightness)
    brightness_max=$(cat /sys/class/backlight/*/max_brightness)
    brightness_level=$(echo "scale=2; ($brightness_val / $brightness_max) * 100" | bc)
    printf "^c$yellow^  "
    printf "^c$yellow^%.0f\n" $brightness_level
}

mem() {
    printf "^c$black^^b$red^  "
    printf "^c$red^^b$black^ $(free -h | awk '/^Mem/ { print $3 }' | sed s/i//g)"
}

wlan() {
    case "$(cat /sys/class/net/wl*/operstate 2>/dev/null)" in
        up) printf "^c$black^ ^b$darkblue^  ^d^%s" " ^c$blue^Connected" ;;
        down) printf "^c$black^ ^b$darkblue^ 睊 ^d^%s" " ^c$blue^Disconnected" ;;
    esac
}

clock() {
    printf "^c$black^ ^b$blue^  "
    printf "^c$black^^b$blue^ $(date '+%H:%M') "
}

while true; do

    [ $interval = 0 ] || [ $(($interval % 3600)) = 0 ] && updates=$(pkg_updates)
    interval=$((interval + 1))

    sleep 1 && xsetroot -name "$updates $(battery) $(brightness) $(cpu) $(mem) $(wlan) $(clock)"
done

